# VPC Terraform Project

AWSä¸Šã«VPCã€EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€Application Load Balancerã‚’æ§‹ç¯‰ã™ã‚‹Terraformãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã™ã€‚

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ä»¥ä¸‹ã®AWSãƒªã‚½ãƒ¼ã‚¹ã‚’è‡ªå‹•æ§‹ç¯‰ã—ã¾ã™ï¼š

- **VPC**: ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒ
- **ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚µãƒ–ãƒãƒƒãƒˆ**: 2ã¤ã®AZï¼ˆap-northeast-1a, ap-northeast-1cï¼‰
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤**: å¤–éƒ¨æ¥ç¶šç”¨
- **Application Load Balancer (ALB)**: é«˜å¯ç”¨æ€§ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—**: ALBçµŒç”±ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹**: é–‹ç™ºç”¨ã‚µãƒ¼ãƒãƒ¼
- **S3ãƒã‚±ãƒƒãƒˆ**: TerraformçŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ç”¨ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æœ‰åŠ¹ï¼‰

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
                    Internet
                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  VPC                    â”‚
â”‚              10.0.0.0/16                â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Internet Gateway              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Application Load Balancer (ALB)  â”‚ â”‚
â”‚  â”‚         (Public Access)            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Public Subnet   â”‚ â”‚ Public Subnet   â”‚â”‚
â”‚  â”‚ 10.0.0.0/24     â”‚ â”‚ 10.0.1.0/24     â”‚â”‚
â”‚  â”‚ ap-northeast-1a â”‚ â”‚ ap-northeast-1c â”‚â”‚
â”‚  â”‚                 â”‚ â”‚                 â”‚â”‚
â”‚  â”‚   [EC2]         â”‚ â”‚   [EC2]         â”‚â”‚
â”‚  â”‚ (ALBçµŒç”±ã®ã¿)    â”‚ â”‚ (ALBçµŒç”±ã®ã¿)    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
vpc-terraform/
â”œâ”€â”€ README.md
â”œâ”€â”€ local.tf                    # å…±é€šå¤‰æ•°å®šç¾©
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .kiro/
â”‚   â””â”€â”€ steering/              # Kiroè¨­å®šãƒ«ãƒ¼ãƒ«
â”‚       â””â”€â”€ terraform-change-policy.md
â”œâ”€â”€ env/
â”‚   â””â”€â”€ dev/                   # é–‹ç™ºç’°å¢ƒ
â”‚       â”œâ”€â”€ main.tf            # ãƒ¡ã‚¤ãƒ³è¨­å®š
â”‚       â”œâ”€â”€ variable.tf        # å¤‰æ•°å®šç¾©
â”‚       â””â”€â”€ terraform.tfvars   # å¤‰æ•°å€¤
â””â”€â”€ modules/
    â”œâ”€â”€ network/               # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    â”‚   â”œâ”€â”€ main.tf            # VPCã€ã‚µãƒ–ãƒãƒƒãƒˆã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—
    â”‚   â”œâ”€â”€ variable.tf        # å¤‰æ•°å®šç¾©
    â”‚   â””â”€â”€ output.tf          # å‡ºåŠ›å€¤
    â”œâ”€â”€ ec2/                   # EC2ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    â”‚   â”œâ”€â”€ main.tf            # EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã€IAMãƒ­ãƒ¼ãƒ«
    â”‚   â”œâ”€â”€ variable.tf        # å¤‰æ•°å®šç¾©
    â”‚   â””â”€â”€ output.tf          # ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹IDã€IPå‡ºåŠ›
    â””â”€â”€ elb/                   # ELBãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæ–°è¦è¿½åŠ ï¼‰
        â”œâ”€â”€ main.tf            # Application Load Balancer
        â”œâ”€â”€ variable.tf        # å¤‰æ•°å®šç¾©
        â””â”€â”€ output.tf          # ALBæƒ…å ±å‡ºåŠ›
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### å‰ææ¡ä»¶

- AWS CLIè¨­å®šæ¸ˆã¿
- Terraform v1.0ä»¥ä¸Š
- é©åˆ‡ãªAWSæ¨©é™

### 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone <repository-url>
cd vpc-terraform
```

### 2. ç’°å¢ƒè¨­å®š

```bash
cd env/dev
```

### 3. å¤‰æ•°è¨­å®š

`terraform.tfvars`ã‚’ç·¨é›†ã—ã¦ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šï¼š

```hcl
# EC2 Configuration
ami           = "ami-0228232d282f16465"  # Amazon Linux 2 AMI
instance_type = "t3.small"
instance_count = 1
```

### 4. S3ãƒã‚±ãƒƒãƒˆåå¤‰æ›´

`main.tf`ã®S3ãƒã‚±ãƒƒãƒˆåã‚’ä¸€æ„ãªåå‰ã«å¤‰æ›´ï¼š

```hcl
bucket = "terraform-state-bucket-dev-your-unique-name"
```

### 5. åˆæœŸåŒ–ã¨å®Ÿè¡Œ

```bash
# TerraformåˆæœŸåŒ–
terraform init

# å®Ÿè¡Œè¨ˆç”»ç¢ºèª
terraform plan

# ãƒªã‚½ãƒ¼ã‚¹ä½œæˆ
terraform apply
```

## âš™ï¸ è¨­å®šå¯èƒ½ãªå¤‰æ•°

### EC2è¨­å®š

| å¤‰æ•°å | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ | ä¾‹ |
|--------|------|-------------|-----|
| `ami` | AMI ID | - | `ami-0228232d282f16465` |
| `instance_type` | ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ— | `t2.micro` | `t3.small` |
| `instance_count` | ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•° | `1` | `2` |

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®š

| å¤‰æ•°å | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ |
|--------|------|-------------|
| `vpc_cidr_block` | VPC CIDR | `10.0.0.0/16` |
| `aws_region` | AWSãƒªãƒ¼ã‚¸ãƒ§ãƒ³ | `ap-northeast-1` |
| `aws_profile` | AWSãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« | `default` |

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—

### ALBç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— (`alb_security`)
- **HTTP (80)**: å…¨ä¸–ç•Œã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ (`0.0.0.0/0`)
- **HTTPS (443)**: å…¨ä¸–ç•Œã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ (`0.0.0.0/0`)
- **Egress**: å…¨ã¦ã®å¤–å‘ãé€šä¿¡è¨±å¯

### EC2ç”¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ— (`developers`)
- **SSH (22)**: ç‰¹å®šIPã‹ã‚‰ã®ã¿ (`153.239.139.130/32`)
- **HTTP (80)**: ALBçµŒç”±ã®ã¿ï¼ˆALBã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ï¼‰
- **HTTPS (443)**: ALBçµŒç”±ã®ã¿ï¼ˆALBã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ï¼‰
- **Egress**: å…¨ã¦ã®å¤–å‘ãé€šä¿¡è¨±å¯

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­è¨ˆ
- **å¤–éƒ¨ã‹ã‚‰ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹**: ALBã®ã¿
- **EC2ã¸ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹**: SSHä»¥å¤–ã¯ä¸å¯
- **Webãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯**: å¿…ãšALBçµŒç”±ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

## ğŸ”§ EC2æ¥ç¶šæ–¹æ³•

### Session Managerï¼ˆæ¨å¥¨ï¼‰

```bash
# AWS Systems ManagerçµŒç”±ã§æ¥ç¶š
aws ssm start-session --target <instance-id>
```

### SSHæ¥ç¶š

ã‚­ãƒ¼ãƒšã‚¢ã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆï¼š

```bash
ssh -i your-key.pem ec2-user@<public-ip>
```

## ğŸ“¦ TerraformçŠ¶æ…‹ç®¡ç†

- **Backend**: S3 (`terraform-state-bucket-dev-kentaindeed`)
- **æš—å·åŒ–**: AES256ã§æœ‰åŠ¹
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**: æœ‰åŠ¹ï¼ˆçŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å±¥æ­´ç®¡ç†ï¼‰
- **ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹**: å®Œå…¨ãƒ–ãƒ­ãƒƒã‚¯
- **çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«**: `terraform.tfstate`
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `ap-northeast-1`

### Backendè¨­å®š
```hcl
terraform {
  backend "s3" {
    bucket = "terraform-state-bucket-dev-kentaindeed"
    key    = "terraform.tfstate"
    region = "ap-northeast-1"
    encrypt = true
  }
}
```

## ğŸ§¹ ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤

```bash
# å…¨ãƒªã‚½ãƒ¼ã‚¹å‰Šé™¤
terraform destroy
```

**æ³¨æ„**: S3ãƒã‚±ãƒƒãƒˆã¯æ‰‹å‹•ã§å‰Šé™¤ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

## ğŸ“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **S3ãƒã‚±ãƒƒãƒˆåé‡è¤‡**
   - `main.tf`ã®ãƒã‚±ãƒƒãƒˆåã‚’ä¸€æ„ãªåå‰ã«å¤‰æ›´

2. **Backendè¨­å®šå¤‰æ›´ã‚¨ãƒ©ãƒ¼**
   ```bash
   # çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ç§»è¡Œ
   terraform init -migrate-state
   ```

3. **æ¨©é™ã‚¨ãƒ©ãƒ¼**
   - AWS CLIã®è¨­å®šã¨IAMæ¨©é™ã‚’ç¢ºèª
   - EC2ã€ELBã€S3ã®æ¨©é™ãŒå¿…è¦

4. **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ä¸ä¸€è‡´**
   - `local.tf`ã¨`terraform.tfvars`ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³è¨­å®šã‚’ç¢ºèª

5. **ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¤‰æ•°ã‚¨ãƒ©ãƒ¼**
   - å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®`variable.tf`ã§å¿…è¦ãªå¤‰æ•°ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ãƒ­ã‚°ç¢ºèª

```bash
# Terraformè©³ç´°ãƒ­ã‚°
export TF_LOG=DEBUG
terraform plan

# è¨ºæ–­æƒ…å ±ç¢ºèª
terraform validate
terraform fmt -check
```

### ALBæ¥ç¶šç¢ºèª

```bash
# ALBã®DNSåç¢ºèª
terraform output alb_dns_name

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç¢ºèª
aws elbv2 describe-target-health --target-group-arn <target-group-arn>
```

## ğŸ¤ è²¢çŒ®

1. ãƒ•ã‚©ãƒ¼ã‚¯ã—ã¦ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
2. å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
3. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ğŸ‘¤ ä½œæˆè€…

- **Owner**: kentaindeed
- **Project**: terraform-project
- **Environment**: dev

## ğŸ”„ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ

### Network Module
- VPCã€ã‚µãƒ–ãƒãƒƒãƒˆã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚²ãƒ¼ãƒˆã‚¦ã‚§ã‚¤
- ALBç”¨ã¨EC2ç”¨ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—
- ãƒ«ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³

### EC2 Module  
- EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆè¤‡æ•°AZã«åˆ†æ•£é…ç½®ï¼‰
- IAMãƒ­ãƒ¼ãƒ«ï¼ˆSSMç”¨ï¼‰
- ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«

### ELB Module
- Application Load Balancer
- Target Groupï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
- ãƒªã‚¹ãƒŠãƒ¼è¨­å®š

## ğŸŒ ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•

### Web ã‚¢ã‚¯ã‚»ã‚¹
```bash
# ALBã®DNSåã§ã‚¢ã‚¯ã‚»ã‚¹
http://<alb-dns-name>
https://<alb-dns-name>
```

### EC2 ç®¡ç†ã‚¢ã‚¯ã‚»ã‚¹
```bash
# Session ManagerçµŒç”±ï¼ˆæ¨å¥¨ï¼‰
aws ssm start-session --target <instance-id>

# SSHï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
ssh -i your-key.pem ec2-user@<private-ip>
```

---

**æ³¨æ„**: ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Kiro AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®è¨­å®šå¤‰æ›´ãƒãƒªã‚·ãƒ¼ã«å¾“ã£ã¦ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚Terraformãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã¯å¿…ãšæ‰¿èªã‚’å¾—ã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚